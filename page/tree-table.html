<html lang="ZH">
<div id="table">
	<div class="handle-box">
		<el-select v-model="value" placeholder="请选择">
			<el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value">
			</el-option>
		</el-select>
		<el-input v-model="input" style="width: 200px;" placeholder="请输入内容"></el-input>
		<el-input v-model="tree" style="width: 200px;" @focus="showTree($event)" placeholder="请选择部门"></el-input>
	</div>
	<div class="toolbar">
		<el-button type="primary" size="small" icon="search">搜索</el-button>
		<el-button type="primary" size="small" icon="add" @click="dialogFormVisible = true">添加</el-button>
		<el-button type="primary" size="small" icon="devare">批量刪除</el-button>
		<el-button size="small" @click="toggleSelection([tableData3[1], tableData3[2]])">切换第二、第三行的选中状态</el-button>
		<el-button size="small" @click="toggleSelection()">取消选择</el-button>
	</div>
	<div class="table">
		<el-table
		    :data="data"
		    border
		    style="width: 100%"
		    :row-style="showTr">
		    <el-table-column v-for="(column, index) in columns" :key="column.dataIndex"
		      :label="column.text">
		      <template scope="scope">
		        <span v-if="spaceIconShow(index)" v-for="(space, levelIndex) in scope.row._level" class="ms-tree-space"></span>
		        <button class="button is-outlined is-primary is-small" v-if="toggleIconShow(index,scope.row)" @click="toggle(scope.$index)">
		          <i v-if="!scope.row._expanded" class="el-icon-plus" aria-hidden="true"></i>
		          <i v-if="scope.row._expanded" class="el-icon-minus" aria-hidden="true"></i>
		        </button>
		        <span v-else-if="index===0" class="ms-tree-space"></span>
		        {{scope.row[column.dataIndex]}}
		      </template>
		    </el-table-column>
		    <el-table-column label="操作" width="260">
		      <template scope="scope">
		        <button type="button" class="el-button el-button--default el-button--small">
		          <!--<router-link
		            :to="{ path: requestUrl + 'edit', query: {id: scope.row.Oid} }"
		            tag="span">-->
		            编辑
		          <!--</router-link>-->
		        </button>
		        <el-button
		          size="small"
		          type="danger"
		          @click="handleDevare()">
		          删除
		        </el-button>
		        <button type="button" class="el-button el-button--success el-button--small">
		          <!--<router-link :to="{ path: requestUrl, query: {parentId: scope.row.parentOId} }"
		                       tag="span">-->
		            添加下级树结构
		          <!--</router-link>-->
		        </button>
		      </template>
		    </el-table-column>
		  </el-table>
	</div>
</div>

<style>
	.handle-box {
		margin-bottom: 20px;
	}
	.toolbar {
		margin: 5px 0;
	}
	.pagination {
		margin: 20px 0;
		text-align: center;
		/*position: fixed;
		bottom: 60px;*/
	}
	  .ms-tree-space{
	  	position: relative;  
	    top: 1px;  
	    display: inline-block;  
	    font-family: 'Glyphicons Halflings';  
	    font-style: normal;  
	    font-weight: 400;  
	    line-height: 1;  
	    width: 18px;  
	    height: 14px;}  
	  .ms-tree-space::before{
	  	content: "";
	  	}  
	  table td{  
	    line-height: 26px;  
	  }
</style>

<script>
	var table = new Vue({
		el: '#table',
		props: {
		// 该属性是确认父组件传过来的数据是否已经是树形结构了，如果是，则不需要进行树形格式化
//		      treeStructure: {
//		        type: Boolean,
//		        default: function () {
//		          return false
//		        }
//		      },
		// 这是相应的字段展示
//		      columns: {
//		        type: Array,
//		        default: function () {
//		          return []
//		        }
//		      },
		// 这是数据源
//		      dataSource: {
//		        type: Array,
//		        default: function () {
//		          return []
//		        }
//		      },
		// 这个作用是根据自己需求来的，比如在操作中涉及相关按钮编辑，删除等，需要向服务端发送请求，则可以把url传过来
//		      requestUrl: {
//		        type: String,
//		        default: function () {
//		          return ''
//		        }
//		      },
		// 这个是是否展示操作列
		      treeType: {
		        type: String,
		        default: function () {
		          return 'normal'
		        }
		      },
		// 是否默认展开所有树
		      defaultExpandAll: {
		        type: Boolean,
		        default: function () {
		          return true
		        }
		      }
		    },
		data: {
			columns: [  
	          {  
	            text: '姓名',  
	            dataIndex: 'name'  
	          },  
	          {  
	            text: '年龄',  
	            dataIndex: 'age'  
	          },  
	          {  
	            text: '性别',  
	            dataIndex: 'sex'  
	          }  
	        ],  
	      dataSource: [  
	        {  
	          id: 1,  
	          parentId: 0,  
	          name: '测试1',  
	          age: 18,  
	          sex: '男',  
	          children: [  
	            {  
	              id: 2,  
	              parentId: 1,  
	              name: '测试2',  
	              age: 22,  
	              sex: '男'  
	            }  
	          ]  
	        },  
	        {  
	          id: 3,  
	          parentId: 0,  
	          name: '测试3',  
	          age: 23,  
	          sex: '女',  
	          children: [  
	            {  
	              id: 4,  
	              parentId: 3,  
	              name: '测试4',  
	              age: 22,  
	              sex: '男'  
	            },  
	            {  
	              id: 5,  
	              parentId: 3,  
	              name: '测试5',  
	              age: 25,  
	              sex: '男'  
	            },  
	            {  
	              id: 6,  
	              parentId: 3,  
	              name: '测试6',  
	              age: 26,  
	              sex: '女',  
	              children: [  
	                {  
	                  id: 7,  
	                  parentId: 6,  
	                  name: '测试7',  
	                  age: 27,  
	                  sex: '男'  
	                }  
	              ]  
	            }  
	          ]  
	        },  
	        {  
	          id: 18,  
	          parentId: 0,  
	          name: '测试8',  
	          age: 18,  
	          sex: '男'  
	        }  
	      ] ,
			multipleSelection: [],
			currentPage4: 4,
			input: '',
			options: [{
				value: '选项1',
				label: '黄金糕'
			}, {
				value: '选项2',
				label: '双皮奶'
			}, {
				value: '选项3',
				label: '蚵仔煎'
			}, {
				value: '选项4',
				label: '龙须面'
			}, {
				value: '选项5',
				label: '北京烤鸭'
			}],
			value: '',
			regions: [{
				'name': 'region1'
			}, {
				'name': 'region2'
			}],
			count: 1,
			dialogTreeVisible: false,
			tree: '',
			treeStructure: true,
		},
		mounted: function() {
		},
		computed: {  
	    // 格式化数据源  
	      data: function () {  
	        var me = this  
	        if (me.treeStructure) {  
	          var data = treeToArray(me.dataSource, null, null, me.defaultExpandAll)  
	          console.log(data)  
	          return data  
	        }  
	        return me.dataSource  
	      }  
	    },
		methods: {
			handleOpen: function(key, keyPath) {
				console.log(key, keyPath);
			},
			handleClose: function(key, keyPath) {
				console.log(key, keyPath);
			},
			toggleSelection: function(rows) {
				if(rows) {
					for(var i = 0; i < rows.length; i++) {
						this.$refs.table.toggleRowSelection(rows[i]);
					}
				} else {
					this.$refs.table.clearSelection();
				}
			},
			handleSelectionChange: function(val) {
				this.multipleSelection = val;
			},
			handleSizeChange: function(val) {
				console.log("每页 ${val} 条");
			},
			handleCurrentChange: function(val) {
				console.log("当前页: ${val}");
			},
			open: function() {
				this.$alert('这是一段内容', '标题名称', {
					confirmButtonText: '确定',
					callback: function(action) {
						this.$message({
							type: 'info',
							message: '123'
						});
					}
				});
			},
			showAddForm: function() {
				console.log('show dailog')
				this.dialogFormVisible = true;
			},
			handleCheckChange: function(data, checked, indeterminate) {
				console.log(data, checked, indeterminate);
			},
			handleNodeClick: function(data) {
				console.log(data);
			},
			loadNode: function(node, resolve) {
				if(node.level === 0) {
					return resolve([{
						name: 'region1'
					}, {
						name: 'region2'
					}]);
				}
				if(node.level > 3) return resolve([]);

				var hasChild;
				if(node.data.name === 'region1') {
					hasChild = true;
				} else if(node.data.name === 'region2') {
					hasChild = false;
				} else {
					hasChild = Math.random() > 0.5;
				}

				setTimeout(function() {
					var data;
					if(hasChild) {
						data = [{
							name: 'zone' + this.count++
						}, {
							name: 'zone' + this.count++
						}];
					} else {
						data = [];
					}

					resolve(data);
				}, 500);
			},
			showTree: function(event) {
				this.dialogTreeVisible = true;
				// 使当前元素失去焦点
				event.target.blur();
			},
			closeDialog: function(app, visibleFlag) {
				console.log(app)
				console.log(visibleFlag)
				this.$confirm('您还没有保存，是否退出?', '提示', {
					confirmButtonText: '确定',
					cancelButtonText: '取消',
			  		type: 'warning'
			    }).then(function() {
					app._data[visibleFlag] = false;
			    }).catch(function() {
			    	
			    });
			},
			open: function(row, expanded) {
				console.log(row);
				console.log(expanded);
			},
			// 显示行
		      showTr: function (row, index) {
		        var show = (row._parent ? (row._parent._expanded && row._parent._show) : true)
		        row._show = show
		        return show ? '' : 'display:none;'
		      },
		    // 展开下级
		      toggle: function (trIndex) {
		        var me = this
		        var record = me.data[trIndex]
		        record._expanded = !record._expanded
		      },
		    // 显示层级关系的空格和图标
		      spaceIconShow (index) {
		        var me = this
		        if (me.treeStructure && index === 0) {
		          return true
		        }
		        return false
		      },
		    // 点击展开和关闭的时候，图标的切换
		      toggleIconShow (index, record) {
		        var me = this
		        if (me.treeStructure && index === 0 && record.children && record.children.length > 0) {
		          return true
		        }
		        return false
		      },
		      handleDevare () {
		        this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {
		          confirmButtonText: '确定',
		          cancelButtonText: '取消',
		          type: 'error'
		        }).then(() => {
		          this.$message({
		            type: 'success',
		            message: '删除成功!'
		          })
		        }).catch(() => {
		          this.$message({
		            type: 'info',
		            message: '已取消删除'
		          })
		        })
		      }
		}
	});
	
function DataTransfer (data) {  
  if (!(this instanceof DataTransfer)) {  
    return new DataTransfer(data, null, null)  
  }  
}  
  
  
function treeToArray (data, parent, level, expandedAll) {  
  var tmp = []  
  Array.from(data).forEach(function (record) {  
    if (record._expanded === undefined) {  
      Vue.set(record, '_expanded', expandedAll)  
    }  
    if (parent) {  
      Vue.set(record, '_parent', parent)  
    }  
    var _level = 0  
    if (level !== undefined && level !== null) {  
      _level = level + 1  
    }  
    Vue.set(record, '_level', _level)  
    tmp.push(record)  
    if (record.children && record.children.length > 0) {  
      var children = treeToArray(record.children, record, _level, expandedAll)  
      tmp = tmp.concat(children)  
    }  
  })  
  console.log(tmp);
  return tmp  
}  
</script>
</html>